
# خطة إنشاء لوحة إدارة شاملة

## نظرة عامة

سيتم إنشاء لوحة إدارة متكاملة وآمنة تتيح للمدير التحكم الكامل في محتوى الموقع، مع أيقونة صغيرة وخفية في أسفل الموقع لا تظهر إلا للمدير.

---

## المكونات الرئيسية

### 1. نظام المصادقة والصلاحيات

**قاعدة البيانات:**
- جدول `profiles` لمعلومات المستخدمين
- جدول `user_roles` للأدوار (admin, moderator, user)
- دالة `has_role()` للتحقق من الصلاحيات بشكل آمن
- سياسات RLS لحماية البيانات

**صفحات المصادقة:**
- صفحة تسجيل الدخول `/admin/login`
- نظام حماية المسارات للصفحات الإدارية

---

### 2. أيقونة الإدارة المخفية

- أيقونة صغيرة جدا (Settings) تحت نص "جميع الحقوق محفوظة" في Footer
- تظهر فقط للمستخدم المسجل بدور "admin"
- عند الضغط عليها تنقل المدير إلى `/admin`

---

### 3. جداول قاعدة البيانات للمحتوى

```text
+-------------------+     +-------------------+     +-------------------+
|    site_content   |     |     programs      |     |    initiatives    |
+-------------------+     +-------------------+     +-------------------+
| id                |     | id                |     | id                |
| section_key       |     | title             |     | title             |
| title             |     | description       |     | short_description |
| content           |     | duration          |     | full_description  |
| image_url         |     | category          |     | objectives        |
| order_index       |     | icon              |     | impact            |
| is_visible        |     | image_url         |     | target_audience   |
| created_at        |     | is_visible        |     | image_url         |
| updated_at        |     | order_index       |     | icon              |
+-------------------+     +-------------------+     +-------------------+

+-------------------+     +-------------------+     +-------------------+
|   site_stats      |     |   media_platforms |     |   site_settings   |
+-------------------+     +-------------------+     +-------------------+
| id                |     | id                |     | id                |
| label             |     | title             |     | key               |
| value             |     | description       |     | value             |
| icon              |     | features          |     | type              |
| order_index       |     | link              |     | updated_at        |
+-------------------+     | is_visible        |     +-------------------+
                          +-------------------+
```

---

### 4. صفحات لوحة الإدارة

| الصفحة | المسار | الوظيفة |
|--------|--------|---------|
| لوحة التحكم | `/admin` | نظرة عامة وإحصائيات سريعة |
| إدارة البرامج | `/admin/programs` | إضافة/تعديل/حذف البرامج والدورات |
| إدارة المبادرات | `/admin/initiatives` | إدارة المبادرات النوعية التسعة |
| إدارة المنصات | `/admin/media` | إدارة المنصات الرقمية |
| المحتوى العام | `/admin/content` | تعديل نصوص الصفحة الرئيسية والأقسام |
| الإحصائيات | `/admin/stats` | تعديل الأرقام والإحصائيات |
| الإعدادات | `/admin/settings` | إعدادات الموقع العامة والفيديو التعريفي |
| رفع الصور | `/admin/media-library` | مكتبة الصور ورفع ملفات جديدة |

---

### 5. مميزات لوحة الإدارة

- واجهة عربية بالكامل
- تصميم متجاوب مع جميع الشاشات
- رفع الصور مباشرة باستخدام Supabase Storage
- معاينة التغييرات قبل الحفظ
- سجل التعديلات (من قام بالتعديل ومتى)
- إمكانية إخفاء/إظهار أي عنصر
- إعادة ترتيب العناصر بالسحب والإفلات

---

## التفاصيل التقنية

### هيكل الملفات الجديدة

```text
src/
├── pages/
│   └── admin/
│       ├── AdminLogin.tsx
│       ├── AdminDashboard.tsx
│       ├── AdminPrograms.tsx
│       ├── AdminInitiatives.tsx
│       ├── AdminMedia.tsx
│       ├── AdminContent.tsx
│       ├── AdminStats.tsx
│       ├── AdminSettings.tsx
│       └── AdminMediaLibrary.tsx
├── components/
│   └── admin/
│       ├── AdminLayout.tsx
│       ├── AdminSidebar.tsx
│       ├── AdminHeader.tsx
│       ├── ProtectedRoute.tsx
│       ├── ImageUploader.tsx
│       └── ContentEditor.tsx
├── hooks/
│   ├── useAuth.ts
│   └── useAdmin.ts
└── contexts/
    └── AuthContext.tsx
```

### Supabase Storage

- إنشاء bucket باسم `media` لتخزين الصور
- سياسات RLS للسماح للمديرين فقط برفع الملفات
- الزوار يمكنهم قراءة الصور العامة فقط

### الهجرات (Migrations)

1. **Migration 1:** إنشاء جداول المحتوى
2. **Migration 2:** إنشاء نظام الأدوار والصلاحيات
3. **Migration 3:** إنشاء bucket التخزين وسياساته
4. **Migration 4:** إضافة البيانات الأولية (المحتوى الحالي)

---

## خطوات التنفيذ

1. إنشاء جداول قاعدة البيانات مع RLS
2. إنشاء نظام المصادقة والأدوار
3. إنشاء bucket التخزين للصور
4. بناء صفحة تسجيل الدخول
5. بناء تخطيط لوحة الإدارة (Sidebar, Header)
6. إنشاء صفحات الإدارة الفرعية
7. تحديث Footer لإضافة أيقونة الإدارة المخفية
8. تحديث الصفحات العامة لجلب المحتوى من قاعدة البيانات
9. ترحيل المحتوى الحالي إلى قاعدة البيانات

---

## ملاحظات أمنية

- الأدوار تُخزن في جدول منفصل (ليس في profiles)
- التحقق من الصلاحيات يتم عبر دالة `SECURITY DEFINER`
- جميع الجداول محمية بـ RLS
- المدير فقط يمكنه الوصول لصفحات الإدارة
- الأيقونة لا تظهر إلا بعد التحقق من قاعدة البيانات

